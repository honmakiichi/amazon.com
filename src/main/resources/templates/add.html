<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<title>ユーザー新規登録</title>
<link rel="stylesheet" type="text/css" href="/css/style.css">
</head>

<body>
	<header th:replace="headertop"></header>
	<hr>
	<h1>ユーザー新規登録</h1>
	<main>
		<form action="/add" method="post">
			<input type="text" name="email" placeholder="メールアドレス"> <br>
			<input type="text" name="name" placeholder="名前"> <br>
			<div class="input-with-icon">
				<input type="password" name="password" id="password"
					placeholder="パスワードを入力"
					oninput="checkPasswordLength(); checkPasswordStrength(); checkPasswordMatch()">
			</div>
			<p id="pw-length-message" style="color: red;"></p>
			<div id="password-strength-message"></div>

			<div class="input-with-icon">
				<input type="password" name="confirmpassword" id="confirmpassword"
					placeholder="パスワード（確認用）" oninput="checkPasswordMatch()">
			</div>
			<p id="pw-match-message" style="color: red;"></p>
			<p th:each="error:${errors}" th:text="${error}" style="color: red;"></p>
			<button type="submit">新規登録</button>
		</form>
	</main>

	<p>
		既にアカウントをお持ちですか？ <a href="/login">ログイン</a>
	</p>
	<hr>
	<footer>
		<p>&copy; ショッピングサイト</p>
	</footer>

	<script>
		const MIN = 6;
		const MAX = 64;

		function checkPasswordLength() {
			const pw = document.getElementById('password').value;
			const msg = document.getElementById('pw-length-message');
			if (pw.length <= 5 || pw.length >= (MAX + 1)) {
				msg.textContent = `パスワードは${MIN}文字以上${MAX}文字以下で入力してください`;
			} else {
				msg.textContent = "";
			}
		}

		function checkPasswordStrength() {
			const password = document.getElementById('password').value;
			const message = document.getElementById('password-strength-message');
			let strength = 0;
			if (password.length >= 8) strength++;
			if (/[a-z]/.test(password)) strength++;
			if (/[A-Z]/.test(password)) strength++;
			if (/[0-9]/.test(password)) strength++;
			if (/[^a-zA-Z0-9]/.test(password)) strength++;
			switch (strength) {
				case 0:
				case 1:
				case 2:
					message.textContent = "⚠️ 推測されやすいパスワードです";
					message.style.color = "red";
					break;
				case 3:
				case 4:
					message.textContent = "⚠️ まずまずですが、さらに強化を推奨します";
					message.style.color = "orange";
					break;
				case 5:
					message.textContent = "✅ 安全性の高いパスワードです";
					message.style.color = "green";
					break;
			}
		}

		function checkPasswordMatch(event) {
			const pw1 = document.getElementById("password").value;
			const pw2 = document.getElementById("confirmpassword").value;
			const matchMsg = document.getElementById("pw-match-message");

			if (pw1 !== pw2) {
				matchMsg.textContent = "⚠️ パスワードが一致していません";
				matchMsg.style.color = "red";
				if (event) event.preventDefault();
			} else {
				matchMsg.textContent = "";
			}
		}

		function togglePasswordVisibility(id) {
			const input = document.getElementById(id);
			const currentType = input.getAttribute("type");
			input.setAttribute("type", currentType === "password" ? "text" : "password");
		}
	</script>
</body>

</html>
